


<script>
const getCart = async (req, res) => {
    try {
        const userId = req.session.user_id;

        // Get the cart separately
        const cart = await Cart.findOne({ userId }).populate('items.productId');

        if (!cart) {
            return res.render('cart', {
                cartItems: [],
                totalAmount: 0
            });
        }

        // Calculate total amount (optional)
        const cartItems = cart.items.map(item => ({
            _id: item.productId._id,
            name: item.productId.name,
            price: item.productId.price,
            quantity: item.quantity,
            total: item.productId.price * item.quantity
        }));

        const totalAmount = cartItems.reduce((sum, item) => sum + item.total, 0);

        res.render('cart', {
            cartItems,
            totalAmount
        });

    } catch (error) {
        console.log('Error during getting the cart page:', error);
        res.status(500).render('error', { message: 'Failed to load cart page' });
    }
};

    
</script>